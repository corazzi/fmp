!function(t){"use strict";var a={prefilled:null,CapitalizeFirstLetter:!1,preventSubmitOnEnter:!0,isClearInputOnEsc:!0,AjaxPush:null,AjaxPushAllTags:null,AjaxPushParameters:null,delimiters:[9,13,44],backspace:[8],maxTags:3,hiddenTagListName:null,hiddenTagListId:null,replace:!0,output:null,deleteTagsOnBackspace:!0,tagsContainer:null,tagCloseIcon:"x",tagClass:"label",validator:null,onlyTagList:!1,tagList:null},e={pushTag:function(a,e){var l=t(this),r=l.data("opts"),n,s,o,d,p=l.data("tlis"),u=l.data("tlid"),g,h,c,m,f,v,T,C;if(a=i.trimTag(a,r.delimiterChars),a&&!(a.length<=0)){if(r.onlyTagList&&void 0!==r.tagList&&r.tagList){var y=r.tagList;t.each(y,function(t,a){y[t]=a.toLowerCase()});var A=t.inArray(a.toLowerCase(),y);if(-1===A)return}r.CapitalizeFirstLetter&&a.length>1&&(a=a.charAt(0).toUpperCase()+a.slice(1).toLowerCase()),(!r.validator||r.validator(a))&&(r.maxTags>0&&p.length>=r.maxTags||(n=!1,s=jQuery.map(p,function(t){return t.toLowerCase()}),g=t.inArray(a.toLowerCase(),s),-1!==g&&(n=!0),n?(l.trigger("tm:duplicated",a),t("#"+l.data("tm_rndid")+"_"+u[g]).stop().animate({backgroundColor:r.blinkBGColor_1},100).animate({backgroundColor:r.blinkBGColor_2},100).animate({backgroundColor:r.blinkBGColor_1},100).animate({backgroundColor:r.blinkBGColor_2},100).animate({backgroundColor:r.blinkBGColor_1},100).animate({backgroundColor:r.blinkBGColor_2},100)):(e||l.trigger("tm:pushing",a),o=Math.max.apply(null,u),o=o===-1/0?0:o,d=++o,p.push(a),u.push(d),e||null!==r.AjaxPush&&null==r.AjaxPushAllTags&&-1===t.inArray(a,r.prefilled)&&t.post(r.AjaxPush,t.extend({tag:a},r.AjaxPushParameters)),h=l.data("tm_rndid")+"_"+d,c=l.data("tm_rndid")+"_Remover_"+d,m=t("<span/>").text(a).html(),f='<span class="'+i.tagClasses.call(l)+'" id="'+h+'">',f+="<span>"+m+"</span>",f+='<a href="#" class="tm-tag-remove" id="'+c+'" TagIdToRemove="'+d+'">',f+=r.tagCloseIcon+"</a></span> ",v=t(f),null!==r.tagsContainer?t(r.tagsContainer).append(v):d>1?(T=d-1,C=t("#"+l.data("tm_rndid")+"_"+T),C.after(v)):l.before(v),v.find("#"+c).on("click",l,function(a){a.preventDefault();var e=parseInt(t(this).attr("TagIdToRemove"));i.spliceTag.call(l,e,a.data)}),i.refreshHiddenTagList.call(l),e||l.trigger("tm:pushed",a),i.showOrHide.call(l)),l.val("")))}},popTag:function(){var a=t(this),e,l,r=a.data("tlis"),n=a.data("tlid");n.length>0&&(e=n.pop(),l=r[r.length-1],a.trigger("tm:popping",l),r.pop(),t("#"+a.data("tm_rndid")+"_"+e).remove(),i.refreshHiddenTagList.call(a),a.trigger("tm:popped",l))},empty:function(){for(var a=t(this),e=a.data("tlis"),l=a.data("tlid"),r;l.length>0;)r=l.pop(),e.pop(),t("#"+a.data("tm_rndid")+"_"+r).remove(),i.refreshHiddenTagList.call(a);a.trigger("tm:emptied",null),i.showOrHide.call(a)},tags:function(){var t=this,a=t.data("tlis");return a}},i={showOrHide:function(){var t=this,a=t.data("opts"),e=t.data("tlis");a.maxTags>0&&e.length<a.maxTags&&(t.show(),t.trigger("tm:show")),a.maxTags>0&&e.length>=a.maxTags&&(t.hide(),t.trigger("tm:hide"))},tagClasses:function(){var a=t(this),e=a.data("opts"),i=e.tagBaseClass,l=e.inputBaseClass,r;return r=i,a.attr("class")&&t.each(a.attr("class").split(" "),function(t,a){-1!==a.indexOf(l+"-")&&(r+=" "+i+a.substring(l.length))}),r+=e.tagClass?" "+e.tagClass:""},trimTag:function(a,e){var i;for(a=t.trim(a),i=0;i<a.length&&-1===t.inArray(a.charCodeAt(i),e);i++);return a.substring(0,i)},refreshHiddenTagList:function(){var a=t(this),e=a.data("tlis"),i=a.data("lhiddenTagList");i&&t(i).val(e.join(a.data("opts").baseDelimiter)).change(),a.trigger("tm:refresh",e.join(a.data("opts").baseDelimiter))},killEvent:function(t){t.cancelBubble=!0,t.returnValue=!1,t.stopPropagation(),t.preventDefault()},keyInArray:function(a,e){return-1!==t.inArray(a.which,e)},applyDelimiter:function(a){var i=t(this);e.pushTag.call(i,t(this).val()),a.preventDefault()},prefill:function(a){var i=t(this);t.each(a,function(t,a){e.pushTag.call(i,a,!0)})},pushAllTags:function(a,e){var i=t(this),l=i.data("opts"),r=i.data("tlis");l.AjaxPushAllTags&&("tm:pushed"!==a.type||-1===t.inArray(e,l.prefilled))&&t.post(l.AjaxPush,t.extend({tags:r.join(l.baseDelimiter)},l.AjaxPushParameters))},spliceTag:function(a){var e=this,l=e.data("tlis"),r=e.data("tlid"),n=t.inArray(a,r),s;-1!==n&&(s=l[n],e.trigger("tm:splicing",s),t("#"+e.data("tm_rndid")+"_"+a).remove(),l.splice(n,1),r.splice(n,1),i.refreshHiddenTagList.call(e),e.trigger("tm:spliced",s)),i.showOrHide.call(e)},init:function(l){var r=t.extend({},a,l),n,s;return r.hiddenTagListName=null===r.hiddenTagListName?"hidden-"+this.attr("name"):r.hiddenTagListName,n=r.delimeters||r.delimiters,s=[9,13,17,18,19,37,38,39,40],r.delimiterChars=[],r.delimiterKeys=[],t.each(n,function(a,e){-1!==t.inArray(e,s)?r.delimiterKeys.push(e):r.delimiterChars.push(e)}),r.baseDelimiter=String.fromCharCode(r.delimiterChars[0]||44),r.tagBaseClass="tm-tag",r.inputBaseClass="tm-input",t.isFunction(r.validator)||(r.validator=null),this.each(function(){var a=t(this),l="",n="",s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";if(a.data("tagManager"))return!1;a.data("tagManager",!0);for(var o=0;5>o;o++)n+=s.charAt(Math.floor(Math.random()*s.length));if(a.data("tm_rndid",n),a.data("opts",r).data("tlis",[]).data("tlid",[]),null===r.output?(l=t("<input/>",{type:"hidden",name:r.hiddenTagListName}),a.after(l),a.data("lhiddenTagList",l)):a.data("lhiddenTagList",t(r.output)),r.AjaxPushAllTags&&(a.on("tm:spliced",i.pushAllTags),a.on("tm:popped",i.pushAllTags),a.on("tm:pushed",i.pushAllTags)),a.on("focus keypress",function(a){t(this).popover&&t(this).popover("hide")}),r.isClearInputOnEsc&&a.on("keyup",function(a){27===a.which&&(t(this).val(""),i.killEvent(a))}),a.on("keypress",function(t){i.keyInArray(t,r.delimiterChars)&&i.applyDelimiter.call(a,t)}),a.on("keydown",function(t){13===t.which&&r.preventSubmitOnEnter&&i.killEvent(t),i.keyInArray(t,r.delimiterKeys)&&i.applyDelimiter.call(a,t)}),r.deleteTagsOnBackspace&&a.on("keydown",function(l){i.keyInArray(l,r.backspace)&&t(this).val().length<=0&&(e.popTag.call(a),i.killEvent(l))}),a.change(function(t){/webkit/.test(navigator.userAgent.toLowerCase())||a.focus(),i.killEvent(t)}),null!==r.prefilled)"object"==typeof r.prefilled?i.prefill.call(a,r.prefilled):"string"==typeof r.prefilled?i.prefill.call(a,r.prefilled.split(r.baseDelimiter)):"function"==typeof r.prefilled&&i.prefill.call(a,r.prefilled());else if(null!==r.output){if(t(r.output)&&t(r.output).val())var d=t(r.output);i.prefill.call(a,t(r.output).val().split(r.baseDelimiter))}}),this}};t.fn.tagsManager=function(a){var l=t(this);return 0 in this?e[a]?e[a].apply(l,Array.prototype.slice.call(arguments,1)):"object"!=typeof a&&a?(t.error("Method "+a+" does not exist."),!1):i.init.apply(this,arguments):this}}(jQuery);